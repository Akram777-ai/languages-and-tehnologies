<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ü–æ–≥–æ–¥–∞ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="card" role="region" aria-label="–ü–æ–≥–æ–¥–∞">
    <h1>–ü–æ–≥–æ–¥–∞ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ üá∞üáø</h1>
    <div class="meta" id="meta">–û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ...</div>

    <div class="top">
      <div>
        <div class="temp" id="temp">--¬∞C</div>
        <div class="desc" id="desc">‚Äî</div>
      </div>
      <div class="icon" id="icon">‚òÅÔ∏è</div>
    </div>

    <div class="info-row">
      <div>üíß –í–ª–∞–∂–Ω–æ—Å—Ç—å: <span id="humidity">‚Äî</span></div>
      <div>üí® –í–µ—Ç–µ—Ä: <span id="wind">‚Äî</span></div>
    </div>

    <div class="controls">
      <input type="text" id="cityInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥ (–ê–ª–º–∞—Ç—ã, –®—ã–º–∫–µ–Ω—Ç...)" />
      <button id="btnSearch">–ü–æ–∫–∞–∑–∞—Ç—å</button>
    </div>

    <div class="note">–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –ø–æ–≥–æ–¥—É –∏ –ø—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 5 –¥–Ω–µ–π.</div>

    <div class="forecast" id="forecast">
      <h2>–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 5 –¥–Ω–µ–π</h2>
      <div class="forecast-container" id="forecastContainer">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
  </div>

  <script>
    const apiKey = "86c326909ce732a85832b98b60b26452";
    const metaEl = document.getElementById('meta');
    const tempEl = document.getElementById('temp');
    const descEl = document.getElementById('desc');
    const iconEl = document.getElementById('icon');
    const humidityEl = document.getElementById('humidity');
    const windEl = document.getElementById('wind');
    const forecastContainer = document.getElementById('forecastContainer');
    const btn = document.getElementById('btnSearch');
    const cityInput = document.getElementById('cityInput');

    btn.addEventListener('click', () => {
      const city = cityInput.value.trim();
      if (!city) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞.');
      fetchByCity(city);
    });

    async function fetchByCity(city) {
      metaEl.textContent = '–ó–∞–≥—Ä—É–∂–∞—é –ø–æ–≥–æ–¥—É...';
      try {
        const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)},KZ&units=metric&lang=ru&appid=${apiKey}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error('–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        const data = await res.json();
        renderWeather(data);
        fetchForecast(city);
      } catch (err) {
        metaEl.textContent = '–û—à–∏–±–∫–∞: ' + err.message;
      }
    }

    async function fetchForecast(city) {
      forecastContainer.textContent = '–ó–∞–≥—Ä—É–∂–∞—é –ø—Ä–æ–≥–Ω–æ–∑...';
      try {
        const url = `https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(city)},KZ&units=metric&lang=ru&appid=${apiKey}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞');
        const data = await res.json();
        renderForecast(data);
      } catch (err) {
        forecastContainer.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–∞: ' + err.message;
      }
    }

    function renderWeather(data) {
      tempEl.textContent = Math.round(data.main.temp) + '¬∞C';
      descEl.textContent = data.weather[0].description;
      humidityEl.textContent = data.main.humidity + '%';
      windEl.textContent = data.wind.speed + ' –º/—Å';
      metaEl.textContent = `${data.name}, –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω`;

      const iconCode = data.weather[0].icon;
      iconEl.innerHTML = `<img src="https://openweathermap.org/img/wn/${iconCode}@2x.png" width="64" height="64" alt="">`;
    }

    function renderForecast(data) {
      // –±–µ—Ä—ë–º –ø—Ä–æ–≥–Ω–æ–∑ –∫–∞–∂–¥—ã–µ 24 —á–∞—Å–∞ (–≤ 12:00)
      const daily = {};
      data.list.forEach(item => {
        if (item.dt_txt.includes("12:00:00")) {
          const date = new Date(item.dt_txt);
          daily[date.toDateString()] = item;
        }
      });

      forecastContainer.innerHTML = '';
      Object.values(daily).slice(0, 5).forEach(day => {
        const date = new Date(day.dt_txt);
        const options = { weekday: 'short', day: 'numeric', month: 'short' };
        const dayStr = date.toLocaleDateString('ru-RU', options);
        const icon = day.weather[0].icon;
        const temp = Math.round(day.main.temp);
        const desc = day.weather[0].description;

        const div = document.createElement('div');
        div.className = 'day';
        div.innerHTML = `
          <div class="day-name">${dayStr}</div>
          <img src="https://openweathermap.org/img/wn/${icon}.png" alt="">
          <div class="day-temp">${temp}¬∞C</div>
          <div class="day-desc">${desc}</div>
        `;
        forecastContainer.appendChild(div);
      });
    }

    (async function init() {
      try {
        const ipRes = await fetch("https://ipapi.co/json/");
        const ipData = await ipRes.json();
        const city = ipData.country_code === "KZ" ? ipData.city || "Astana" : "Astana";
        fetchByCity(city);
      } catch {
        fetchByCity("Astana");
      }
    })();
  </script>
</body>
</html>